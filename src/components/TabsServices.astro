---
const servicios = [
  {
    tipo: "preventiva",
    titulo: "Ciberseguridad Preventiva",
    items: [
      {
        titulo: "Auditoría de Seguridad Integral",
        descripcion:
          "Evaluación de riesgos y madurez: nube, endpoints, redes y aplicaciones.",
        puntos: [
          "Inventario y priorización de activos",
          "Gap analysis vs. buenas prácticas",
          "Roadmap de remediación",
        ],
      },
      {
        titulo: "Pentesting Web & Apps",
        descripcion:
          "Pruebas de intrusión manuales con reporte ejecutivo y técnico.",
        puntos: ["OWASP Top 10", "Evidencias y PoC", "Re-test incluido"],
      },
      {
        titulo: "Seguridad de Redes & WiFi",
        descripcion: "Hardening de infraestructura y segmentación efectiva.",
        puntos: [
          "Configuración segura",
          "Pruebas de cobertura",
          "Accesos privilegiados",
        ],
      },
    ],
  },
  {
    tipo: "reactiva",
    titulo: "Ciberseguridad Reactiva",
    items: [
      {
        titulo: "Respuesta a Incidentes",
        descripcion:
          "Contención, erradicación y recuperación con guía de crisis.",
        puntos: [
          "Playbooks efectivos",
          "Restauración priorizada",
          "Lecciones aprendidas",
        ],
      },
      {
        titulo: "Forense Digital",
        descripcion: "Adquisición, análisis y preservación de evidencias.",
        puntos: ["Timeline & IOC hunting", "Informe pericial", "Soporte legal"],
      },
      {
        titulo: "Remediación de Vulnerabilidades",
        descripcion: "Correcciones guiadas y verificación de efectividad.",
        puntos: [
          "Parcheo y hardening",
          "Revisión de accesos",
          "Validación post-fix",
        ],
      },
    ],
  },
  {
    tipo: "avanzada",
    titulo: "Ciberseguridad Avanzada",
    items: [
      {
        titulo: "Monitorización 24/7 (SOC/SIEM)",
        descripcion: "Detección temprana y respuesta coordinada.",
        puntos: [
          "Casos de uso a medida",
          "Alertas priorizadas",
          "Informes ejecutivos",
        ],
      },
      {
        titulo: "Threat Hunting & Intel",
        descripcion: "Búsqueda proactiva de amenazas y TTPs relevantes.",
        puntos: [
          "Detecciones hipotéticas",
          "IOC/IOA feed",
          "Mitre ATT&CK mapping",
        ],
      },
      {
        titulo: "Protección de Correo y Nube",
        descripcion:
          "Controles avanzados para O365/Google Workspace y nubes públicas.",
        puntos: ["DMARC, DKIM, SPF", "CASB / posture", "Automatización (SOAR)"],
      },
    ],
  },
  {
    tipo: "formacion",
    titulo: "Formación y Concienciación",
    items: [
      {
        titulo: "Charlas & Talleres",
        descripcion: "Sesiones prácticas orientadas a negocio y TI.",
        puntos: [
          "Buenas prácticas",
          "Gestión de contraseñas",
          "Seguridad móvil",
        ],
      },
      {
        titulo: "Simulacros de Phishing",
        descripcion: "Campañas medibles con micro-learning.",
        puntos: [
          "Plantillas realistas",
          "KPIs por equipo",
          "Refuerzo inmediato",
        ],
      },
      {
        titulo: "Programas a Medida",
        descripcion: "Formación por rol: directivos, finanzas, IT & soporte.",
        puntos: [
          "Calendario trimestral",
          "Materiales reutilizables",
          "Certificados",
        ],
      },
    ],
  },
];
---

<section
  class="section tabs bg-section-dark py-16 dark:bg-surface-dark sm:py-24"
  id="servicios"
  aria-labelledby="servicios-title">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8">
    <h2
      class="text-3xl font-extrabold text-white sm:text-4xl text-center"
      id="servicios-title">
      Servicios Nyxion
    </h2>
    <p
      class="mt-4 text-lg text-text-muted-dark dark:text-text-muted-dark text-center">
      Cobertura total en cuatro líneas:
      <strong>Preventiva</strong>, <strong>Reactiva</strong>,
      <strong>Avanzada</strong> y <strong>Formación</strong>. Intervenimos donde
      más impacto tiene para tu negocio.
    </p>

    <!-- Dropdown solo en móvil -->
    <div class="block lg:hidden mt-8">
      <label for="mobile-tabs" class="sr-only">Selecciona un servicio</label>

      <select
        id="mobile-tabs"
        class="w-full p-3 rounded-md bg-white text-text-light border border-border-light
           dark:bg-background-dark dark:text-white dark:border-border-dark
           focus:outline-none focus:ring-2 focus:ring-primary">
        {servicios.map((s) => <option value={s.tipo}>{s.titulo}</option>)}
      </select>
    </div>

    <!-- Tabs escritorio -->
    <div
      class="tab-nav mt-12 hidden lg:flex flex-wrap justify-center gap-4 border-b border-border-light dark:border-border-dark px-2">
      {
        servicios.map((s) => (
          <button
            class="tab-btn whitespace-nowrap px-4 py-3 border-b-2 border-transparent
         text-sm md:text-base text-text-muted-dark
         hover:text-primary-light hover:border-primary-light
         transition-all duration-200 font-medium cursor-pointer"
            data-tab={s.tipo}>
            {s.titulo}
          </button>
        ))
      }
    </div>

    <!-- Paneles -->
    <div class="tab-panels mt-12">
      {
        servicios.map((s, i) => (
          <div
            id={`tab-${s.tipo}`}
            class={`cards tab-panel ${i === 0 ? "" : "hidden"} grid gap-8 md:grid-cols-2 lg:grid-cols-3`}
            role="region"
            aria-label={s.titulo}>
            {s.items.map((item) => (
              <article class="rounded-lg border border-border-light bg-background-light p-6 shadow-sm dark:border-border-dark dark:bg-background-dark transition-transform hover:scale-[1.01]">
                <h3 class="font-bold text-lg text-text-light dark:text-white">
                  {item.titulo}
                </h3>
                <p class="mt-2 text-text-muted-light dark:text-text-muted-dark">
                  {item.descripcion}
                </p>
                <ul class="mt-2 list-disc pl-5 text-sm text-text-muted-light dark:text-text-muted-dark">
                  {item.puntos.map((p) => (
                    <li>{p}</li>
                  ))}
                </ul>
              </article>
            ))}
          </div>
        ))
      }
    </div>
  </div>
</section>

<script is:inline>
  document.addEventListener("DOMContentLoaded", () => {
    const buttons = document.querySelectorAll(".tab-btn");
    const panels = document.querySelectorAll(".tab-panel");
    const select = document.getElementById("mobile-tabs");

    // --- Estado inicial ---
    if (buttons.length && panels.length) {
      buttons[0].classList.add("text-white", "font-semibold", "border-primary");
      panels[0].classList.remove("hidden");
      if (select) select.value = buttons[0].dataset.tab;
    }

    // --- Click tabs escritorio ---
    buttons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const target = btn.dataset.tab;
        buttons.forEach((b) =>
          b.classList.remove("text-white", "font-semibold", "border-primary"),
        );
        panels.forEach((panel) => panel.classList.add("hidden"));

        btn.classList.add("text-white", "font-semibold", "border-primary");
        document.getElementById(`tab-${target}`).classList.remove("hidden");

        if (select) select.value = target;
      });
    });

    // --- Cambio en móvil (dropdown) ---
    if (select) {
      select.addEventListener("change", (e) => {
        const target = e.target.value;
        panels.forEach((panel) => panel.classList.add("hidden"));
        document.getElementById(`tab-${target}`).classList.remove("hidden");

        buttons.forEach((b) =>
          b.classList.remove("text-white", "font-semibold", "border-primary"),
        );
        const active = document.querySelector(`[data-tab="${target}"]`);
        if (active)
          active.classList.add("text-white", "font-semibold", "border-primary");
      });
    }
  });
</script>

<style>
  /* Fuerza que el tab-nav se oculte siempre en pantallas pequeñas */
  @media (max-width: 1023px) {
    .tab-nav {
      display: none !important;
    }
  }
</style>
